shadow$provide.module$node_modules$$sentry$browser$dist$transports$base=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("module$node_modules$tslib$tslib"),core_1=require("module$node_modules$$sentry$core$dist$index"),types_1=require("module$node_modules$$sentry$types$dist$index"),utils_1=require("module$node_modules$$sentry$utils$dist$index"),utils_2=require("module$node_modules$$sentry$browser$dist$transports$utils"),CATEGORY_MAPPING=
{event:"error",transaction:"transaction",session:"session",attachment:"attachment"};global=utils_1.getGlobalObject();require=function(){function BaseTransport(options){var _this=this;this.options=options;this._buffer=new utils_1.PromiseBuffer(30);this._rateLimits={};this._outcomes={};this._api=new core_1.API(options.dsn,options._metadata,options.tunnel);this.url=this._api.getStoreEndpointWithUrlEncodedAuth();this.options.sendClientReports&&global.document&&global.document.addEventListener("visibilitychange",
function(){"hidden"===global.document.visibilityState&&_this._flushOutcomes()})}BaseTransport.prototype.sendEvent=function(_){throw new utils_1.SentryError("Transport Class has to implement `sendEvent` method");};BaseTransport.prototype.close=function(timeout){return this._buffer.drain(timeout)};BaseTransport.prototype.recordLostEvent=function(reason,category){var _a;this.options.sendClientReports&&(reason=CATEGORY_MAPPING[category]+":"+reason,utils_1.logger.log("Adding outcome: "+reason),this._outcomes[reason]=
(_a=this._outcomes[reason],null!==_a&&void 0!==_a?_a:0)+1)};BaseTransport.prototype._flushOutcomes=function(){if(this.options.sendClientReports){var outcomes=this._outcomes;this._outcomes={};if(Object.keys(outcomes).length){utils_1.logger.log("Flushing outcomes:\n"+JSON.stringify(outcomes,null,2));var url=this._api.getEnvelopeEndpointWithUrlEncodedAuth(),envelopeHeader=JSON.stringify(tslib_1.__assign({},this.options.tunnel&&{dsn:this._api.getDsn().toString()})),itemHeaders=JSON.stringify({type:"client_report"}),
item=JSON.stringify({timestamp:utils_1.dateTimestampInSeconds(),discarded_events:Object.keys(outcomes).map(function(key){var _a=tslib_1.__read(key.split(":"),2);return{reason:_a[1],category:_a[0],quantity:outcomes[key]}})});try{utils_2.sendReport(url,envelopeHeader+"\n"+itemHeaders+"\n"+item)}catch(e){utils_1.logger.error(e)}}else utils_1.logger.log("No outcomes to flush")}};BaseTransport.prototype._handleResponse=function(_a){var requestType=_a.requestType,response=_a.response,headers=_a.headers,
resolve=_a.resolve;_a=_a.reject;var status=types_1.Status.fromHttpCode(response.status);this._handleRateLimit(headers)&&utils_1.logger.warn("Too many "+requestType+" requests, backing off until: "+this._disabledUntil(requestType));status===types_1.Status.Success?resolve({status}):_a(response)};BaseTransport.prototype._disabledUntil=function(requestType){return this._rateLimits[CATEGORY_MAPPING[requestType]]||this._rateLimits.all};BaseTransport.prototype._isRateLimited=function(requestType){return this._disabledUntil(requestType)>
new Date(Date.now())};BaseTransport.prototype._handleRateLimit=function(headers){var _a,e_2,_b,now=Date.now(),rlHeader=headers["x-sentry-rate-limits"];headers=headers["retry-after"];if(rlHeader){try{for(var _c=tslib_1.__values(rlHeader.trim().split(",")),_d=_c.next();!_d.done;_d=_c.next()){var parameters=_d.value.split(":",2),headerDelay=parseInt(parameters[0],10),delay=1E3*(isNaN(headerDelay)?60:headerDelay);try{for(var _e=(e_2=void 0,tslib_1.__values(parameters[1].split(";"))),_f=_e.next();!_f.done;_f=
_e.next())this._rateLimits[_f.value||"all"]=new Date(now+delay)}catch(e_2_1){e_2={error:e_2_1}}finally{try{_f&&!_f.done&&(_b=_e.return)&&_b.call(_e)}finally{if(e_2)throw e_2.error;}}}}catch(e_1_1){var e_1={error:e_1_1}}finally{try{_d&&!_d.done&&(_a=_c.return)&&_a.call(_c)}finally{if(e_1)throw e_1.error;}}return!0}return headers?(this._rateLimits.all=new Date(now+utils_1.parseRetryAfterHeader(now,headers)),!0):!1};return BaseTransport}();exports.BaseTransport=require}
//# sourceMappingURL=module$node_modules$$sentry$browser$dist$transports$base.js.map
