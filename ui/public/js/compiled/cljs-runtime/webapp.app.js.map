{"version":3,"sources":["webapp/app.cljs"],"mappings":";;;AAkCA,+BAAA,/BAAMA;AAAN,AACE,OAACC,oDAAY,qBAAA,2CAAA,0JAAA,qEAAA,8KAAA,7cAACC,mHAAc,AAAA,iFAAMC,8KACI,KAAAC,kKACG,AAAA,6GAAoBD;;AAE/D,wBAAA,xBAACE,+BAAkCL;AAEnC;;;iCAAA,jCAAMM;AAAN,AAGE,IAAMC,gBAAc,AAAA,AAAIC;IAClBC,aAAW,KAAKC,gBAAmBH;IACnCI,QAAM,eAAA,fAAMF;IACZG,cAAY,AAACC,+BAAiB,eAAA,fAAMJ;IACpCK,QAAM,eAAA,fAAML;IACZM,sBAAoB,qBAAA,rBAAUC;IAC9BC,UAAQ,yBAAA,PAAIH,4DAAa,uCAAA,oDAAA,zFAAI,AAACI,uBAAON;AAN3C,AAOE,uBAAA,mFAAA,1GAACO,wMAAwCP;;AACzC,qBAAA,rBAAUI,iCAA4BL;;AACtC,GAAI,wBAAA,vBAAMI;AACR,uBAAA,mFAAA,1GAACI,sKAAuBF;;AACxB,IAAMG,UAAE,AAAU,AAAGZ,wBAAqBO;IACpCK,cAAE,wBAAA,xBAAaJ;AADrB,AAAA;;AAEF,oBAAMF;AAAN,AAAY,uBAAA,mFAAA,1GAACK,gNAAuCL;;AAApD;;AAbF,0FAAA,mDAAA,2BAAA,mFAAA,+DAAA,mFAAA,2FAAA,2CAAA,oDAAA;;AAmBF,GAAA,QAAAO,mCAAAC,uCAAAC;AAAA;AAAA,AAAA,oBAAA,iBAAAC,6BAAA,AAAAC,6CAAA,/GAAUS;IAAVR,6BAAA,AAAAD,6CAAA;IAAAE,6BAAA,AAAAF,6CAAA;IAAAG,iCAAA,AAAAH,6CAAA;IAAAI,0BAAA,AAAAC,4CAAA,mCAAA,gEAAA,iBAAAC,eAAA;AAAA,AAAA,QAAAA,6CAAAA,+CAAAA;;AAAA,AAAA,YAAAC,kBAAA,AAAAC,+CAAA,aAAA,6BAAA,4DAAAJ,wBAAAL,2BAAAE,2BAAAC,2BAAAC,xLAAiBO;;;AACjB,AAAAD,8DAAA,kEAAA,WAAgCd,EAAEgB;AAAlC,AAAA,0FAAA,oNAAA,4KAAA,oIAAA,mFAAA,sDAAA,0HAAA,mFAAA,2DAAA,2CAAA,9yBAEG,AAACC,gCACD,AAACC,qHACAC,4CACD,AAACC,gIACAC,6QAECC,wRAEQ,CAAA,kCAAA,uBAAA,2DAGRN;;AACL,AAAAF,8DAAA,6EAAA,WAAqCd,EAAEgB;AAAvC,AAAA,0FAAA,2DAAA,2CAAA,8IAAA,2JAAA,4KAAA,oIAAA,mFAAA,sDAAA,0HAAA,mFAAA,v3BAEW,CAAA,4CAAA,4HAEPC,sCACD,AAACC,qHACAC,4CACD,AAACC,gIACAC,6QAECC,yNAC2BN;;AAChC,AAAAF,8DAAA,qDAAA,WAAyBd,EAAEgB;AAA3B,AAAA,0FAAA,yKAAA,mFAAA,zHAEG,AAACG,+QAEAH;;AAEJ,AAAAO,iEAAA,yEAAA;AAAA,AAAA,4GAAA,kEAAA,pFACGT,uKAAqBU;;AACxB,AAAAD,iEAAA,iEAAA;AAAA,AACE,uDAAA,kEAAA,lHAACT,qMAAqBW;;AACxB,AAAAF,iEAAA,kEAAA;AAAA,AACE,uDAAA,kEAAA,lHAACT,qMAAqBY;;AACxB,AAAAH,iEAAA,wEAAA;AAAA,AACE,uDAAA,kEAAA,lHAACT,qMAAqBa;;AACxB,AAAAJ,iEAAA,mFAAA;AAAA,AACE,uDAAA,kEAAA,yHAAA,3OAACT,qMAAqBc;;AACxB,AAAAL,iEAAA,+EAAA,WAA6CvB,EAAE6B;AAA/C,AACE,IAAMC,WAAS,AAAA,AAAI1C;IACb2C,gBAAc,sBAAA,AAAAC,tBAACC,sCAAkBC,sBAAcJ;IAC/CK,cAAY,AAAA,mFAAO,AAAA,mGAAeJ;AAFxC,AAGE,uBAAA,mFAAA,2GAAA,2CAAA,hQAAChC,oUAAuDoC;;AACxD,uDAAA,kEAAA,yHAAA,3OAACrB,qMAAqBc;;AAC1B,AAAAL,iEAAA,sEAAA;AAAA,AACE,uDAAA,kEAAA,lHAACT,qMAAqBsB;;AACxB,AAAAb,iEAAA,mEAAA;AAAA,AACE,uBAAA,mFAAA,1GAACxB;;AACD,uBAAA,mFAAA,1GAACA;;AACD,uDAAA,kEAAA,lHAACe,qMAAqBuB;;AACxB,AAAAd,iEAAA,wEAAA;AAAA,AAAA,4GAAA,6EAAA,/FACGT,kLAA0BwB;;AAC7B,AAAAf,iEAAA,iGAAA,WAAsDvB;AAAtD,AACE,IAAM8B,WAAS,AAAA,AAAI1C;IACb2C,gBAAc,sBAAA,AAAAC,tBAACC,sCAAkBC,sBAAcJ;IAC/CK,cAAY,AAAA,kGAAA,AAAA,mGAAIJ;AAFtB,AAAA,4GAAA,6EAAA,0HAAA,2CAAA,pQAGGjB,kLAA0BwB,sJAAkCH;;AACjE,AAAAZ,iEAAA,+EAAA,WAA6CvB;AAA7C,AACE,IAAM8B,WAAS,AAAA,AAAI1C;IACb2C,gBAAc,sBAAA,AAAAC,tBAACC,sCAAkBC,sBAAcJ;IAC/CS,UAAQ,AAAA,gFAAK,AAAA,mGAAeR;AAFlC,AAGE,uBAAA,mFAAA,yEAAA,2CAAA,9NAAChC,gRAAkCwC;;AACnC,uDAAA,kEAAA,lHAACzB,qMAAqB0B;;AAC1B,AAAAjB,iEAAA,+EAAA;AAAA,AACE,uDAAA,kEAAA,lHAACT,qMAAqB2B;;AACxB,AAAAlB,iEAAA,mFAAA;AAAA,AAAA,0FACGrC;;AACH,AAAAqC,iEAAA,oEAAA;AAAA,AACE,uDAAA,qDAAA,rGAACT,wLAAc4B;;AACjB,AAAAnB,iEAAA,qEAAA;AAAA,AACE,uDAAA,qDAAA,rGAACT,wLAAc6B;;AACjB,AAAApB,iEAAA,0FAAA;AAAA,AACE,uDAAA,qDAAA,rGAACT,wLAAc8B;;AACjB,AAAArB,iEAAA,0EAAA;AAAA,AACE,uDAAA,qDAAA,rGAACT,wLAAc+B;;AAEjB,iBAAA,jBAAMC,0CAAK9B;AAAX,AAAmBA;;AAEnB,wBAAA,xBAAM+B;AAAN,AACE,IAAMC,eAAa,sDAAA,mFAAA,zIAACC;AAApB,AAAA,yGAAA,wGAAA,AAAAjB,vHACGc,kGAAKvB,qCAAeyB","names":["webapp.app/initialize-sentry","js/module$node_modules$$sentry$browser$dist$index.init","cljs.core/clj->js","webapp.config/sentry","js/module$node_modules$$sentry$tracing$dist$index.Integrations.BrowserTracing","js/window.addEventListener","webapp.app/auth-callback-panel","search-string","js/window","url-params","js/URLSearchParams","token","slack-param","goog.crypt.base64/decodeString","error","redirect-after-auth","js/localStorage","destiny","cljs.core/empty?","re-frame.core/dispatch","_","js/webapp","js/webapp.app","js/webapp.app.layout","method-table__4747__auto__","cljs.core.atom","prefer-table__4748__auto__","method-cache__4749__auto__","cached-hierarchy__4750__auto__","hierarchy__4751__auto__","cljs.core.get","fexpr__30466","cljs.core/MultiFn","cljs.core.symbol","webapp.app/layout","cljs.core/identity","panels","webapp.components.modal/modal","webapp.components.dialog/dialog","webapp.components.snackbar/snackbar","webapp.components.loaders/over-page-loader","webapp.quickstarts.views.main-modal/main","webapp.shared-ui.header/header","webapp.routes/panels","webapp.settings.views.main/main","webapp.views.home/home-panel","webapp.users.views.main/users-panel","webapp.targets.views.main/panel","webapp.targets.views.target-form/main","name","pathname","current-route","cljs.core/deref","bidi.bidi/match-route","webapp.routes/routes","target-name","webapp.agents.views.main/panel","webapp.tasks.views.main/panel","webapp.tasks.views.new-task.panel/main","task-id","webapp.tasks.views.item-detail/item-detail","webapp.quickstarts.views.main/main","webapp.auth.views.login-panel/panel","webapp.auth.views.signup-panel/panel","webapp.integrations.slack/slack-panel","webapp.settings.views.slack-integration-callback/main","webapp.app/app","webapp.app/main-panel","active-panel","re_frame.core.subscribe"],"sourcesContent":["(ns webapp.app\n  (:require\n   [webapp.config :as config]\n   [re-frame.core :as rf]\n   [bidi.bidi :as bidi]\n   [\"@sentry/browser\" :as sentry]\n   [\"@sentry/tracing\" :as sentry-tracing]\n   [goog.crypt.base64 :as b64]\n   [webapp.routes :as routes]\n   [webapp.shared-ui.header :as header]\n   [webapp.views.home :as home]\n   [webapp.users.views.main :as users]\n   [webapp.targets.views.main :as targets]\n   [webapp.targets.views.target-form :as target-form]\n   [webapp.agents.views.main :as agents]\n   [webapp.tasks.views.main :as tasks]\n   [webapp.tasks.views.new-task.panel :as new-task-panel]\n   [webapp.settings.views.main :as settings]\n   [webapp.tasks.views.item-detail :as task-details]\n   [webapp.quickstarts.views.main :as quickstarts]\n   [webapp.quickstarts.views.main-modal :as quickstarts-modal]\n   [webapp.auth.views.login-panel :as login-panel]\n   [webapp.auth.views.signup-panel :as signup-panel]\n   [webapp.integrations.slack :as integrations]\n   [webapp.settings.views.slack-integration-callback :as slack-cb-panel]\n   [webapp.events]\n   [webapp.auth.events :as auth-events]\n   [webapp.targets.events :as targets-events]\n   [webapp.components.modal :as modals]\n   [webapp.components.dialog :as dialog]\n   [webapp.components.snackbar :as snackbar]\n   [webapp.components.loaders :as loaders]\n   [webapp.subs :as subs]))\n\n(defn initialize-sentry []\n  (sentry/init (clj->js {:dsn (:dsn config/sentry)\n                         :integrations [(sentry-tracing/Integrations.BrowserTracing.)]\n                         :tracesSampleRate (:trace-sample-rate config/sentry)})))\n\n(js/window.addEventListener \"load\" initialize-sentry)\n\n(defn auth-callback-panel\n  \"This panel works for receiving the token and storing in the session for later requests\"\n  []\n  (let [search-string (.. js/window -location -search)\n        url-params (new js/URLSearchParams search-string)\n        token (.get url-params \"token\")\n        slack-param (b64/decodeString (.get url-params \"slack\"))\n        error (.get url-params \"error\")\n        redirect-after-auth (.getItem js/localStorage \"redirect-after-auth\")\n        destiny (if error :login (if (empty? slack-param) :home :slack-integration))]\n    (rf/dispatch [:set-slack-integration-url slack-param])\n    (.setItem js/localStorage \"jwt-token\" token)\n    (if (nil? redirect-after-auth)\n      (rf/dispatch [:navigate destiny])\n      (let [_ (.replace (. js/window -location) redirect-after-auth)\n            _ (.removeItem js/localStorage \"redirect-after-auth\")]))\n    (when error (rf/dispatch [::auth-events/login-error error]))\n\n    [:div \"Verifying authentication\"\n     [:span.w-16\n      [:img.inline.animate-spin {:src \"/icons/icon-refresh.svg\"}]]]))\n\n(defmulti layout identity)\n(defmethod layout :application [_ panels]\n  [:section.min-h-screen.h-full.antialiased.bg-gray-50\n   (modals/modal)\n   (dialog/dialog)\n   [snackbar/snackbar]\n   (loaders/over-page-loader)\n   [quickstarts-modal/main]\n   [:main\n    [header/header]\n    [:section\n     {:class (str \"container min-w-app__container \"\n                  \"rounded-lg bg-white \"\n                  \"py-regular px-large mx-auto mb-x-large\")}\n     panels]]])\n(defmethod layout :application-full [_ panels]\n  [:section\n   {:class (str \"min-h-screen h-full min-w-app__container \"\n                \"antialiased bg-white\")}\n   [modals/modal]\n   (dialog/dialog)\n   [snackbar/snackbar]\n   (loaders/over-page-loader)\n   [quickstarts-modal/main]\n   [:main\n    [header/header]\n    [:section.mb-x-large.w-full panels]]])\n(defmethod layout :auth [_ panels]\n  [:section.min-h-screen.antialiased.bg-gray-50\n   (snackbar/snackbar)\n   [:section.container.rounded-main-large.p-large.mx-auto\n    panels]])\n\n(defmethod routes/panels :settings-panel []\n  [layout :application [settings/main]])\n(defmethod routes/panels :home-panel []\n  (layout :application [home/home-panel]))\n(defmethod routes/panels :users-panel []\n  (layout :application [users/users-panel]))\n(defmethod routes/panels :targets-panel []\n  (layout :application [targets/panel]))\n(defmethod routes/panels :target-create-panel []\n  (layout :application [target-form/main :create]))\n(defmethod routes/panels :target-edit-panel [_ name]\n  (let [pathname (.. js/window -location -pathname)\n        current-route (bidi/match-route @routes/routes pathname)\n        target-name (:name (:route-params current-route))]\n    (rf/dispatch [::targets-events/get-target {:target-name target-name}])\n    (layout :application [target-form/main :update])))\n(defmethod routes/panels :agents-panel []\n  (layout :application [agents/panel]))\n(defmethod routes/panels :tasks-panel []\n  (rf/dispatch [:get-tasks])\n  (rf/dispatch [:get-reviews])\n  (layout :application [tasks/panel]))\n(defmethod routes/panels :new-task-panel []\n  [layout :application-full [new-task-panel/main]])\n(defmethod routes/panels :new-task-with-target-panel [_]\n  (let [pathname (.. js/window -location -pathname)\n        current-route (bidi/match-route @routes/routes pathname)\n        target-name (-> current-route :route-params :target-name)]\n    [layout :application-full [new-task-panel/main {:target-name target-name}]]))\n(defmethod routes/panels :task-detail-panel [_]\n  (let [pathname (.. js/window -location -pathname)\n        current-route (bidi/match-route @routes/routes pathname)\n        task-id (:id (:route-params current-route))]\n    (rf/dispatch [:get-task-by-id {:id task-id}])\n    (layout :application [task-details/item-detail])))\n(defmethod routes/panels :quickstarts-panel []\n  (layout :application [quickstarts/main]))\n(defmethod routes/panels :auth-callback-panel []\n  [auth-callback-panel])\n(defmethod routes/panels :login-panel []\n  (layout :auth [login-panel/panel]))\n(defmethod routes/panels :signup-panel []\n  (layout :auth [signup-panel/panel]))\n(defmethod routes/panels :slack-integration-panel []\n  (layout :auth [integrations/slack-panel]))\n(defmethod routes/panels :slack-cb-panel []\n  (layout :auth [slack-cb-panel/main]))\n\n(defn app [panels] panels)\n\n(defn main-panel []\n  (let [active-panel (rf/subscribe [::subs/active-panel])]\n    [app [routes/panels @active-panel]]))\n\n"]}