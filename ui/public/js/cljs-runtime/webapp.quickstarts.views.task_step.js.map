{"version":3,"sources":["webapp/quickstarts/views/task_step.cljs"],"mappings":";AAQA,iDAAA,jDAAMA;AAAN,AACE,eAAA,AAAAC,XAAMC,2BAAU,sDAAA,mFAAA,zIAACC;AAAjB,AACE,8BAAA,mFAAA,0EAAA,2CAAA,4JAAA,0KAAA,riBAACC,yRACsB,AAAA,wFAASF,2EACL,AAAA,+FAAaA,qEAChB,AAAA,kGAAcA;;AAE1C,4DAAA,5DAAMG,gIAAwBC;AAA9B,AACE,IAAMC,WAAS,AAAWD;IACpBE,MAAI,AAAWF;AADrB,AAEE,oBAAM,iBAAAG,oBAAKF;AAAL,AAAA,oBAAAE;AAAc,wDAAA,jDAACC,6CAAEF;;AAAjBC;;;AAAN,AAAgC,OAACT;;AAAjC;;;AAEJ,0CAAA,1CAAMW,4FACHC,YAAYC;AADf,AAEE,eAAA,AAAAZ,XAAMC,2BAAU,sDAAA,mFAAA,zIAACC;sBAAjB,wCAAA,mEAAA,+DAAA,qDAAA,sDAAA,gEAAA,oDAAA,kDAAA,+DAAA,6DAAA,0BAAA,KAAA,xmBACMa,snBACQ,iBAAAC,mBAAI,AAAA,wFAASf;AAAb,AAAA,oBAAAe;AAAAA;;AAAA;;KAFd,WAAAH;AAAA,AAIoB,iEAAAA,1DAACT;GAJrB,KAAA,cAAA,WAAAU;AAAA,AAGmB,8BAAA,mFAAA,1GAACX,6LAAkC,AAAA,AAAAW;GAHtD;+BAAA,2CAAA,uDAAA,aAAA,4EAAA,8DAAA,KAAA,yDAAA,mFAAA,2CAAA,sEAAA,thBAWMG,sMAEWL,gUAEQA,sEAAsBA;AAf/C,AAgBE,GAAM,+IAAA,/IAACH,6CAAE,AAAA,wFAASR;AAAlB,AAAsC,uFAAA,sDAAA,oCAAA,sDAAA,tOAACU,4CAAAA,8GAAAA;;AAAvC;;AACA,uBAAA,mFAAA,1GAACR,uMAAuCS;;AAjB1C,0FAAA,2DAAA,mFAAA,mDAAA,2CAAA,wDAAA,qCAAA,mFAAA,mDAAA,2CAAA,wDAAA,8IAAA,mFAAA,mDAAA,2CAAA,wDAAA,wDAAA,mFAAA,mDAAA,2CAAA,wDAAA,qCAAA,mFAAA,mDAAA,2CAAA,wDAAA,0FAAA,mFAAA,mDAAA,2CAAA,wDAAA,xrCAqBK,8BAAA,WAAA,zCAACM,s4BAIA,AAACC,+BAAaF,ySAEf,iCAAA,2CAAA,sDAAA,0DAAA,wkBAAA,6DAAA,j0BAACG,0PAEW,iKAAA,/JAAI,sJAAA,tJAACX,6CAAE,AAAA,+FAAaR,qBAAc,+IAAA,/IAACQ,6CAAE,AAAA,wFAASR,mBAAc,+IAAA,/IAACQ,6CAAE,AAAA,wFAASR;AAFpF,AAGa,OAACF;4BA9BnB,mFAAA,mDAAA,mFAAA,sDAAA,2CAAA,qDAAA,sBAAA,4JAAA,gIAAA,2CAAA,qPAAA,mKAAA,6PAAA,z4BAiCMsB,iCAAeN,2HAEjBO,6IACO,AAAA,8FAAY,AAAA,uFAASrB,4EACf,AAAA,wFAASA,6EACR,AAAA,wFAAS,AAAA,uFAASA,4EACnB,AAAA,mFAAO,AAAA,uFAASA","names":["webapp.quickstarts.views.task-step/create-task","cljs.core/deref","new-task","re_frame.core.subscribe","re-frame.core/dispatch","webapp.quickstarts.views.task-step/submit-task-on-keydown","e","meta-key","key","and__4251__auto__","cljs.core._EQ_","webapp.quickstarts.views.task-step/main","change-step","connection-name","p1__30503#","p1__30502#","textarea-config","or__4253__auto__","connection-select-config","webapp.components.headings/h2","webapp.components.forms/select","webapp.components.button/primary","webapp.components.forms/textarea","webapp.tasks.views.tasks-logs-container/main"],"sourcesContent":["(ns webapp.quickstarts.views.task-step\n  (:require [re-frame.core :as rf]\n            [webapp.subs :as subs]\n            [webapp.components.forms :as forms]\n            [webapp.components.button :as button]\n            [webapp.components.headings :as h]\n            [webapp.tasks.views.tasks-logs-container :as logs-container]))\n\n(defn create-task []\n  (let [new-task @(rf/subscribe [::subs/new-task])]\n    (rf/dispatch [:create-new-task\n                  {:script (:script new-task)\n                   :connection (:connection new-task)\n                   :message (:description new-task)}])))\n\n(defn submit-task-on-keydown [e]\n  (let [meta-key (.-metaKey e)\n        key (.-keyCode e)]\n    (when (and meta-key (= key 13)) (create-task))))\n\n(defn main\n  [change-step connection-name]\n  (let [new-task @(rf/subscribe [::subs/new-task])\n        textarea-config\n        {:value (or (:script new-task) \"\")\n         :on-change #(rf/dispatch [:set-new-task-script (-> % .-target .-value)])\n         :on-keyDown #(submit-task-on-keydown %)\n         :placeholder \"Insert your script here\"\n         :autoFocus true\n         :name \"script_area\"\n         :id \"script_area\"\n         :rows 10\n         :classes \"font-mono\"}\n        connection-select-config\n        {:label \"Connection\"\n         :selected connection-name\n         :disabled true\n         :options [{:value connection-name :text connection-name}]}]\n    (when (= (:status new-task) :success) (change-step :task \"complete\"))\n    (rf/dispatch [:new-task->set-connection connection-name])\n    [:section\n     [:div {:class \"flex items-end gap-regular\"}\n      [:div {:class \"mb-regular place-self-center flex-grow\"}\n       (h/h2 \"New task\" {})]]\n     [:div {:class \"flex justify-between items-center gap-regular\"}\n      [:div {:class \"flex flex-grow justify-end\"}\n       [:div {:class \"w-full\"}\n        (forms/select connection-select-config)]]\n      [:div {:class \"flex-shrink\"}\n       (button/primary\n        {:text :Create\n         :disabled (or (= (:connection new-task) \"\") (= (:script new-task) \"\") (= (:status new-task) :loading))\n         :on-click #(create-task)})]]\n     [:div\n      [:form {:name \"script_form\"}\n       [forms/textarea textarea-config]]]\n\n     [logs-container/main\n      {:logs (:task_logs (:result new-task))\n       :log-status (:status new-task)\n       :task-status (:status (:result new-task))\n       :connection (:type (:result new-task))}]]))\n\n"]}