{"version":3,"sources":["webapp/dashboard/queries/running.cljs"],"mappings":"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","names":["webapp.dashboard.queries.running/queries-list-empty","webapp.dashboard.queries.running/query-item","item","re-frame.core/dispatch","webapp.tasks.views.task-details/main","webapp.formatters/time-ago","webapp.dashboard.queries.running/queries-list","queries","iter__4652__auto__","s__31074","cljs.core/LazySeq","temp__5753__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4650__auto__","size__4651__auto__","cljs.core/count","b__31076","cljs.core/chunk-buffer","i__31075","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__31073","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","webapp.dashboard.queries.running/main","running-queries","re_frame.core.subscribe","_","interval","js/window","cljs.core/not","js/document","reagent.core.create_class","webapp.components.headings/h3","cljs.core/deref","webapp.components.card/main","cljs.core/empty?","cljs.core/chunk-first"],"sourcesContent":["(ns webapp.dashboard.queries.running\n  (:require\n   [reagent.core :as r]\n   [re-frame.core :as rf]\n   [webapp.formatters :as formatters]\n   [webapp.tasks.views.task-details :as task-details]\n   [webapp.components.card :as card]\n   [webapp.components.headings :as h]))\n\n(defn- queries-list-empty []\n  [:div {:class (str \"flex flex-grow items-center justify-center h-full \"\n                     \"text-xs text-gray-500 font-italic\")}\n   [:span \"No tasks running at the moment\"]])\n\n(defn- query-item [item]\n  [:div {:class (str \"flex gap-small items-center p-small border-b border-gray-200 text-xs \"\n                     \"hover:bg-gray-50 cursor-pointer\")\n         :on-click (fn []\n                     (rf/dispatch [:get-task-by-id item])\n                     (rf/dispatch [:open-modal\n                                   [task-details/main {:copy-to-new-script? true}] :large]))}\n   [:span {:class \"text-xxs font-bold text-gray-500\"}\n    (:id item)]\n   [:span {:class \"text-gray-700\"}\n    (:user_email item)]\n   [:span {:class \"flex items-center text-gray-800\"}\n    [:span {:class \"font-bold\"}\n     (:target item)]\n    [:i {:class \"ml-0.5 text-gray-700\"} [:small (str \"(\" (:type item) \")\")]]]\n   [:span {:class \"text-xxs text-gray-500 flex-grow text-right\"}\n    (str \"Since \" (formatters/time-ago (:created item)))]])\n\n(defn- queries-list [queries]\n  [:div\n   (for [item (:data queries)]\n     ^{:key (:id item)}\n     [query-item item])])\n\n(defn main []\n  (let [running-queries (rf/subscribe [:dashboard->running-queries])\n        _ (rf/dispatch [:dashboard->get-running-queries])\n        interval (.setInterval js/window\n                               (fn []\n                                 (when (not (.-hidden js/document))\n                                   (rf/dispatch [:dashboard->get-running-queries]))) 10000)]\n    (r/create-class\n     {:display-name \"running-tasks/main\"\n      :component-will-unmount (fn []\n                                (.clearInterval js/window interval))\n      :reagent-render\n      (fn []\n        [:div\n         [:header {:class \"flex items-center px-small\"}\n          [h/h3\n           \"Running now\"\n           {:class \"mb-small flex-grow\"}]\n          [:div {:class (str \"flex-shrink text-xs px-1.5 pt-0.5 font-bold text-center \"\n                             \"text-white h-5 rounded-full bg-gray-900\")}\n           (count (-> @running-queries :results :data))]]\n         [card/main\n          {:inner-space? false\n           :class \"h-56\"\n           :children (if (empty? (-> @running-queries :results :data))\n                       [queries-list-empty]\n                       [queries-list\n                        (:results @running-queries)\n                        (:status @running-queries)])}]])})))\n"]}