shadow$provide.module$node_modules$$sentry$core$dist$baseclient=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("module$node_modules$tslib$tslib"),hub_1=require("module$node_modules$$sentry$hub$dist$index"),types_1=require("module$node_modules$$sentry$types$dist$index"),utils_1=require("module$node_modules$$sentry$utils$dist$index"),integration_1=require("module$node_modules$$sentry$core$dist$integration");global=function(){function BaseClient(backendClass,
options){this._integrations={};this._numProcessing=0;this._backend=new backendClass(options);this._options=options;options.dsn&&(this._dsn=new utils_1.Dsn(options.dsn))}BaseClient.prototype.captureException=function(exception,hint,scope){var _this=this;if(utils_1.checkOrSetAlreadyCaught(exception))utils_1.logger.log("Not capturing exception because it's already been captured.");else{var eventId=hint&&hint.event_id;this._process(this._getBackend().eventFromException(exception,hint).then(function(event){return _this._captureEvent(event,
hint,scope)}).then(function(result){eventId=result}));return eventId}};BaseClient.prototype.captureMessage=function(message,level,hint,scope){var _this=this,eventId=hint&&hint.event_id;message=utils_1.isPrimitive(message)?this._getBackend().eventFromMessage(String(message),level,hint):this._getBackend().eventFromException(message,hint);this._process(message.then(function(event){return _this._captureEvent(event,hint,scope)}).then(function(result){eventId=result}));return eventId};BaseClient.prototype.captureEvent=
function(event,hint,scope){if((null===hint||void 0===hint?0:hint.originalException)&&utils_1.checkOrSetAlreadyCaught(hint.originalException))utils_1.logger.log("Not capturing exception because it's already been captured.");else{var eventId=hint&&hint.event_id;this._process(this._captureEvent(event,hint,scope).then(function(result){eventId=result}));return eventId}};BaseClient.prototype.captureSession=function(session){this._isEnabled()?"string"!==typeof session.release?utils_1.logger.warn("Discarded session because of missing or non-string release"):
(this._sendSession(session),session.update({init:!1})):utils_1.logger.warn("SDK not enabled, will not capture session.")};BaseClient.prototype.getDsn=function(){return this._dsn};BaseClient.prototype.getOptions=function(){return this._options};BaseClient.prototype.getTransport=function(){return this._getBackend().getTransport()};BaseClient.prototype.flush=function(timeout){var _this=this;return this._isClientDoneProcessing(timeout).then(function(clientFinished){return _this.getTransport().close(timeout).then(function(transportFlushed){return clientFinished&&
transportFlushed})})};BaseClient.prototype.close=function(timeout){var _this=this;return this.flush(timeout).then(function(result){_this.getOptions().enabled=!1;return result})};BaseClient.prototype.setupIntegrations=function(){this._isEnabled()&&!this._integrations.initialized&&(this._integrations=integration_1.setupIntegrations(this._options))};BaseClient.prototype.getIntegration=function(integration){try{return this._integrations[integration.id]||null}catch(_oO){return utils_1.logger.warn("Cannot retrieve integration "+
integration.id+" from the current Client"),null}};BaseClient.prototype._updateSessionFromEvent=function(session,event){var _a,crashed=!1,errored=!1;if(event=event.exception&&event.exception.values){errored=!0;try{for(var exceptions_1=tslib_1.__values(event),exceptions_1_1=exceptions_1.next();!exceptions_1_1.done;exceptions_1_1=exceptions_1.next()){var mechanism=exceptions_1_1.value.mechanism;if(mechanism&&!1===mechanism.handled){crashed=!0;break}}}catch(e_1_1){var e_1={error:e_1_1}}finally{try{exceptions_1_1&&
!exceptions_1_1.done&&(_a=exceptions_1.return)&&_a.call(exceptions_1)}finally{if(e_1)throw e_1.error;}}}if((e_1=session.status===types_1.SessionStatus.Ok)&&0===session.errors||e_1&&crashed)session.update(tslib_1.__assign(tslib_1.__assign({},crashed&&{status:types_1.SessionStatus.Crashed}),{errors:session.errors||Number(errored||crashed)})),this.captureSession(session)};BaseClient.prototype._sendSession=function(session){this._getBackend().sendSession(session)};BaseClient.prototype._isClientDoneProcessing=
function(timeout){var _this=this;return new utils_1.SyncPromise(function(resolve){var ticked=0,interval=setInterval(function(){0==_this._numProcessing?(clearInterval(interval),resolve(!0)):(ticked+=1,timeout&&ticked>=timeout&&(clearInterval(interval),resolve(!1)))},1)})};BaseClient.prototype._getBackend=function(){return this._backend};BaseClient.prototype._isEnabled=function(){return!1!==this.getOptions().enabled&&void 0!==this._dsn};BaseClient.prototype._prepareEvent=function(event,scope,hint){var _this=
this,_a=this.getOptions().normalizeDepth,normalizeDepth=void 0===_a?3:_a;event=tslib_1.__assign(tslib_1.__assign({},event),{event_id:event.event_id||(hint&&hint.event_id?hint.event_id:utils_1.uuid4()),timestamp:event.timestamp||utils_1.dateTimestampInSeconds()});this._applyClientOptions(event);this._applyIntegrationsMetadata(event);hint&&hint.captureContext&&(scope=hub_1.Scope.clone(scope).update(hint.captureContext));_a=utils_1.SyncPromise.resolve(event);scope&&(_a=scope.applyToEvent(event,hint));
return _a.then(function(evt){return"number"===typeof normalizeDepth&&0<normalizeDepth?_this._normalizeEvent(evt,normalizeDepth):evt})};BaseClient.prototype._normalizeEvent=function(event,depth){if(!event)return null;var normalized=tslib_1.__assign(tslib_1.__assign(tslib_1.__assign(tslib_1.__assign(tslib_1.__assign({},event),event.breadcrumbs&&{breadcrumbs:event.breadcrumbs.map(function(b){return tslib_1.__assign(tslib_1.__assign({},b),b.data&&{data:utils_1.normalize(b.data,depth)})})}),event.user&&
{user:utils_1.normalize(event.user,depth)}),event.contexts&&{contexts:utils_1.normalize(event.contexts,depth)}),event.extra&&{extra:utils_1.normalize(event.extra,depth)});event.contexts&&event.contexts.trace&&(normalized.contexts.trace=event.contexts.trace);event=this.getOptions()._experiments;return(void 0===event?{}:event).ensureNoCircularStructures?utils_1.normalize(normalized):normalized};BaseClient.prototype._applyClientOptions=function(event){var options=this.getOptions(),environment=options.environment,
release=options.release,dist=options.dist,_a=options.maxValueLength;_a=void 0===_a?250:_a;"environment"in event||(event.environment="environment"in options?environment:"production");void 0===event.release&&void 0!==release&&(event.release=release);void 0===event.dist&&void 0!==dist&&(event.dist=dist);event.message&&(event.message=utils_1.truncate(event.message,_a));(options=event.exception&&event.exception.values&&event.exception.values[0])&&options.value&&(options.value=utils_1.truncate(options.value,
_a));(event=event.request)&&event.url&&(event.url=utils_1.truncate(event.url,_a))};BaseClient.prototype._applyIntegrationsMetadata=function(event){var integrationsArray=Object.keys(this._integrations);0<integrationsArray.length&&(event.sdk=event.sdk||{},event.sdk.integrations=tslib_1.__spread(event.sdk.integrations||[],integrationsArray))};BaseClient.prototype._sendEvent=function(event){this._getBackend().sendEvent(event)};BaseClient.prototype._captureEvent=function(event,hint,scope){return this._processEvent(event,
hint,scope).then(function(finalEvent){return finalEvent.event_id},function(reason){utils_1.logger.error(reason)})};BaseClient.prototype._processEvent=function(event,hint,scope){var _this=this,_b$jscomp$0,_c=this.getOptions(),beforeSend=_c.beforeSend;_c=_c.sampleRate;var transport=this.getTransport();if(!this._isEnabled())return utils_1.SyncPromise.reject(new utils_1.SentryError("SDK not enabled, will not capture event."));var isTransaction="transaction"===event.type;return!isTransaction&&"number"===
typeof _c&&Math.random()>_c?(null===(_b$jscomp$0=transport.recordLostEvent)||void 0===_b$jscomp$0?void 0:_b$jscomp$0.call(transport,types_1.Outcome.SampleRate,"event"),utils_1.SyncPromise.reject(new utils_1.SentryError("Discarding event because it's not included in the random sample (sampling rate \x3d "+_c+")"))):this._prepareEvent(event,scope,hint).then(function(prepared){var _b;if(null===prepared)throw null===(_b=transport.recordLostEvent)||void 0===_b?void 0:_b.call(transport,types_1.Outcome.EventProcessor,
event.type||"event"),new utils_1.SentryError("An event processor returned null, will not send event.");if(hint&&hint.data&&!0===hint.data.__sentry__||isTransaction||!beforeSend)return prepared;prepared=beforeSend(prepared,hint);return _this._ensureBeforeSendRv(prepared)}).then(function(processedEvent){var _b;if(null===processedEvent)throw null===(_b=transport.recordLostEvent)||void 0===_b?void 0:_b.call(transport,types_1.Outcome.BeforeSend,event.type||"event"),new utils_1.SentryError("`beforeSend` returned `null`, will not send event.");
_b=scope&&scope.getSession&&scope.getSession();!isTransaction&&_b&&_this._updateSessionFromEvent(_b,processedEvent);_this._sendEvent(processedEvent);return processedEvent}).then(null,function(reason){if(reason instanceof utils_1.SentryError)throw reason;_this.captureException(reason,{data:{__sentry__:!0},originalException:reason});throw new utils_1.SentryError("Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: "+reason);})};
BaseClient.prototype._process=function(promise){var _this=this;this._numProcessing+=1;void promise.then(function(value){--_this._numProcessing;return value},function(reason){--_this._numProcessing;return reason})};BaseClient.prototype._ensureBeforeSendRv=function(rv){if(utils_1.isThenable(rv))return rv.then(function(event){if(!utils_1.isPlainObject(event)&&null!==event)throw new utils_1.SentryError("`beforeSend` method has to return `null` or a valid event.");return event},function(e){throw new utils_1.SentryError("beforeSend rejected with "+
e);});if(!utils_1.isPlainObject(rv)&&null!==rv)throw new utils_1.SentryError("`beforeSend` method has to return `null` or a valid event.");return rv};return BaseClient}();exports.BaseClient=global}
//# sourceMappingURL=module$node_modules$$sentry$core$dist$baseclient.js.map
