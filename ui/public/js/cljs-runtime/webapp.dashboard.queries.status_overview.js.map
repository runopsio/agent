{"version":3,"sources":["webapp/dashboard/queries/status_overview.cljs"],"mappings":"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","names":["webapp.dashboard.queries.status-overview/runops-status","webapp.dashboard.queries.status-overview/status-item","_","status-total","re_frame.core.subscribe","status","start-date","end-date","url-params","webapp.utilities/get-url-params","selected-connection","cljs.core.get","selected-user","cljs.core/deref","webapp.dashboard.queries.status-overview/status-list","cljs.core.doall","iter__4652__auto__","s__51313","cljs.core/LazySeq","temp__5753__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4650__auto__","size__4651__auto__","cljs.core/count","b__51315","cljs.core/chunk-buffer","i__51314","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__51312","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","item","webapp.dashboard.queries.status-overview/main","today","js/Date","iso-today","filtered-dates","reagent.core.atom","days-ago","days","base-date","parsed","state","dates-options","switch-dates","date","re-frame.core/dispatch","cljs.core._EQ_","webapp.components.headings/h3","s__51319","b__51321","i__51320","iter__51318","G__51322","cljs.core/chunk-first"],"sourcesContent":["(ns webapp.dashboard.queries.status-overview\n  (:require\n   [reagent.core :as r]\n   [re-frame.core :as rf]\n   [webapp.utilities :as utilities]\n   [webapp.components.headings :as h]))\n\n(def ^:private runops-status\n  [\"success\" \"failure\" \"pending-review\" \"approved\" \"rejected\"])\n\n(defn- status-item [_ _ _]\n  (let [status-total (rf/subscribe [:dashboard->status-total-by-date])]\n    (fn [status start-date end-date]\n      (let [url-params (utilities/get-url-params)\n            selected-connection (get url-params \"connection\")\n            selected-user (get url-params \"user-email\")]\n      [:li {:class (str \"flex gap-small items-center px-regular py-small \"\n                        \"text-xs border-b border-gray-100 last:border-b-0 \"\n                        \"hover:bg-gray-50 \")}\n       [:span {:class \"italic flex-grow\"}\n        status]\n       [:span\n        [:b (get (:results @status-total) status)]]\n       [:span {:class \"text-blue-500 hover:underline ml-large\"}\n        [:a {:href (str \"/queries?status=\" status\n                        \"&start-date=\" (str start-date \" 00:00:00\")\n                        \"&end-date=\" (str end-date \" 23:59:59\")\n                        (when selected-connection\n                          (str \"&target=\" selected-connection))\n                        (when selected-user\n                          (str \"&user-email=\" selected-user)))}\n         \"View in queries\"]]]))))\n\n(defn- status-list [_ _]\n  (fn [start-date end-date]\n    [:ul\n     (doall\n      (for [item runops-status]\n        ^{:key item}\n        [status-item item start-date end-date]))]))\n\n(defn main []\n  (let [today (new js/Date)\n        iso-today (str (.getFullYear today) \"-\"\n                       (inc (.getMonth today)) \"-\"\n                       (.getDate today))\n        filtered-dates (r/atom {:start-date iso-today\n                                :end-date iso-today})\n        days-ago (fn [days]\n                   (let [base-date (new js/Date)\n                         _ (.setDate base-date (- (.getDate base-date) days))\n                         parsed (str (.getFullYear base-date) \"-\"\n                                     (inc (.getMonth base-date)) \"-\"\n                                     (.getDate base-date))]\n                     parsed))\n        state (rf/subscribe [:dashboard->status-total-by-date])\n        dates-options [\"30 days\" \"15 days\" \"7 days\" \"Today\"]\n        switch-dates (fn [date]\n                       (rf/dispatch [:dashboard->get-status-total-by-date\n                                     {:last-x-days date}]))\n        _ (switch-dates \"7 days\")]\n    (fn []\n      [:div {:class (when (= (:status @state) :loading)\n                      \"opacity-50 pointer-events-none\")}\n       [:header {:class \"flex gap-small items-center mb-small px-small\"}\n        [h/h3 \"Queries by status\" {:class \"flex-grow\"}]\n        [:div {:class (str \"flex gap-regular flex-shrink \"\n                           \"text-xs text-gray-600 \")}\n         (doall\n          (for [date dates-options]\n            ^{:key date}\n            [:span {:class (str \"cursor-pointer hover:text-blue-500 \"\n                                (when (= date (:selected-days @state))\n                                  \"text-blue-500\"))\n                    :on-click (fn []\n                                (switch-dates date))}\n             date]))]]\n       [:div\n        [status-list\n         (case (:selected-days @state)\n           \"Today\" iso-today\n           \"7 days\" (days-ago 7)\n           \"15 days\" (days-ago 15)\n           \"30 days\" (days-ago 30)\n           (days-ago 7))\n         (:end-date @filtered-dates)]]])))\n"]}