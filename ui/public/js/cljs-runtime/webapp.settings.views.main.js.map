{"version":3,"sources":["webapp/settings/views/main.cljs"],"mappings":"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","names":["webapp.settings.views.main/layout","title","subtitle","content","webapp.components.headings/h4","p__30355","map__30358","cljs.core/--destructure-map","cljs.core.get","webapp.settings.views.main/link-button","link","link-text","img-src","img-alt","on-click","webapp.settings.views.main/slack-integration","_","webapp.settings.views.main/no-webhooks-available","webapp.components.button/primary","re-frame.core/dispatch","webapp.settings.views.main/webhooks-integration","fexpr__30360","webapp.settings.views.main/github-connection","webapp.settings.views.main/stripe-link","webapp.settings.views.main/slack-connection","webapp.settings.views.main/personal-settings","webapp.components.headings/h2","webapp.settings.views.main/org-settings","orgs-response","reagent.core.atom","webapp.http.runops-api/request","res","cljs.core/reset!","webapp.components.divider/main","cljs.core/deref","js/webapp","js/webapp.settings","js/webapp.settings.views","js/webapp.settings.views.main","js/webapp.settings.views.main.selected-view","method-table__4747__auto__","cljs.core.atom","prefer-table__4748__auto__","method-cache__4749__auto__","cached-hierarchy__4750__auto__","hierarchy__4751__auto__","fexpr__30363","cljs.core/MultiFn","cljs.core.symbol","webapp.settings.views.main/selected-view","cljs.core/identity","admin?","webapp.settings.views.users/main","webapp.settings.views.agents/main","webapp.settings.views.main/main","user","re_frame.core.subscribe","selected-tab","cljs.core.println","user-groups","p1__30364#","cljs.core/some","cljs.core._EQ_","p1__30365#","webapp.components.tabs/tabs"],"sourcesContent":["(ns webapp.settings.views.main\n  (:require [re-frame.core :as rf]\n            [reagent.core :as r]\n            [webapp.components.button :as button]\n            [webapp.components.divider :as divider]\n            [webapp.components.headings :as h]\n            [webapp.components.tabs :as tabs]\n            [webapp.http.runops-api :as runops-api]\n            [webapp.settings.events]\n            [webapp.settings.events.agents]\n            [webapp.settings.events.users]\n            [webapp.settings.views.agents :as agents]\n            [webapp.settings.views.users :as users]))\n\n(defn- layout [title subtitle content]\n  [:div.grid.grid-cols-5.gap-large\n   [:div.col-span-2\n    [h/h4 title {:class \"mb-regular\"}]\n    [:span.text-sm.text-gray-700 (when subtitle subtitle)]]\n   [:div.col-span-3 content]])\n\n(defn- link-button\n  [{:keys [link link-text img-src img-alt on-click]}]\n  [:a\n   {:class \"flex gap-regular items-center justify-center border rounded-lg p-regular cursor-pointer hover:bg-gray-100 transition\"\n    :href link\n    :on-click on-click\n    :target \"_blank\"}\n   [:figure.w-12\n    [:img {:src img-src\n           :alt img-alt}]]\n   [:span\n    {:class \"text-sm\"}\n    link-text]])\n\n(defn- slack-integration [_]\n  (fn [link]\n    [layout \"Slack integration\"\n     \"Integrate your organization Slack to get more power from Runops\"\n     [:div\n      [link-button {:link link\n                    :link-text \"Integrate your organization Slack with Runops\"\n                    :img-src \"/images/Slack_icon_2019.svg\"\n                    :img-alt \"Slack icon\"}]]]))\n\n(defn no-webhooks-available []\n  [:div {:class \"mx-auto p-regular\"}\n   [:span {:class \"block font-bold mb-large text-center\"}\n    \"Webhooks integration is not available for your organization. Please contact us for more information.\"]\n   [:div {:class \"grid grid-cols-3\"}\n    [:div {:class \"col-start-2\"}\n     (button/primary {:text \"Close\"\n                      :on-click #(rf/dispatch [:close-modal])})]]])\n\n(defn- webhooks-integration [_]\n  (fn [link]\n    [layout \"Webhook integration\"\n     \"Integrate the webhooks to get information updates from Runops\"\n     [:div\n      [link-button {:link link\n                    :on-click #((when (nil? link)\n                                  (rf/dispatch [:open-modal [no-webhooks-available]])))\n                    :link-text \"Integrate with webhooks\"\n                    :img-src \"/images/webhooks.svg\"\n                    :img-alt \"Webhooks icon\"}]]]))\n\n(defn- github-connection [_]\n  (fn [link]\n    [layout \"Github connection\"\n     \"Connect your Github account to get the power of templates at tasks\"\n     [:div\n      [link-button {:link link\n                    :link-text \"Integrate with Github\"\n                    :img-src \"/images/github-mark-icon.png\"\n                    :img-alt \"Github icon\"}]]]))\n\n(defn- stripe-link [_]\n  (fn [link]\n    [layout \"Stripe access\"\n     \"Access Stripe to check your billing information\"\n     [:div\n      [link-button {:link link\n                    :link-text \"Acess Stripe by clicking here\"\n                    :img-src \"/images/stripe-logo.svg\"\n                    :img-alt \"Stripe icon\"}]]]))\n\n(defn- slack-connection [_]\n  (fn []\n    [layout \"Slack connection\"\n     \"Connect your Slack user and get the best of Runops on running your queries and scripts\"\n     [:div\n      [link-button {:on-click #(rf/dispatch [:check-slack-integration])\n                    :link-text \"Connect your user on Slack\"\n                    :img-src \"/images/Slack_icon_2019.svg\"\n                    :img-alt \"Slack icon\"}]]]))\n\n(defn- personal-settings []\n  [:div\n   {:class (str \"flex flex-col gap-large mb-large\")}\n   [h/h2 \"Personal integrations\" {:class \"mb-regular\"}]\n   [slack-connection]])\n\n(defn- org-settings []\n  (let [orgs-response (r/atom nil)\n        _ (runops-api/request {:method \"GET\"\n                               :uri \"/v1/orgs\"\n                               :on-success (fn [res]\n                                             (reset! orgs-response res))})]\n    (fn []\n      [:div\n       {:class (str \"flex flex-col gap-large\")}\n       [divider/main]\n       [h/h2 \"Organization integrations\" {:class \"mb-regular\"}]\n       [slack-integration (:slack_integration_url @orgs-response)]\n       [github-connection (:github_integration_url @orgs-response)]\n       [webhooks-integration (:webhooks_customer_portal_url @orgs-response)]\n       (when (not (nil? (:stripe_customer_portal_url @orgs-response)))\n         [:div {:class \"flex flex-col gap-large\"}\n          [h/h2 :Billing {:class \"mb-large\"}]\n          [divider/main]\n          [stripe-link (:stripe_customer_portal_url @orgs-response)]])])))\n\n(defmulti ^:private selected-view identity)\n(defmethod ^:private selected-view :Integrations [_ admin?]\n  [:div\n   [personal-settings]\n   (when admin? [org-settings])])\n(defmethod ^:private selected-view :default [_]\n  [:div \"default\"])\n(defmethod ^:private selected-view :Users [_]\n  [users/main])\n(defmethod ^:private selected-view :Agents [_]\n  [agents/main])\n\n(defn main []\n  (let [orgs-response (r/atom nil)\n        user (rf/subscribe [:user])\n        _ (rf/dispatch [:settings->get-users])\n        selected-tab (r/atom :Integrations)]\n    (runops-api/request {:method \"GET\"\n                         :uri \"/v1/orgs\"\n                         :on-success (fn [res]\n                                       (reset! orgs-response res))\n                         :on-failure #(println \"couldn't get admin resources\")})\n    (fn []\n      (let [user-groups (:groups @user)\n            admin? (some #(= \"admin\" %) user-groups)]\n        [:div {:class \"px-large\"}\n         (when admin?\n           [tabs/tabs {:on-change #(reset! selected-tab %)\n                       :tabs [:Integrations :Users :Agents]}])\n         [selected-view @selected-tab admin?]]))))\n"]}