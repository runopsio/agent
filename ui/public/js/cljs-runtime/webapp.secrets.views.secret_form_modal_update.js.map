{"version":3,"sources":["webapp/secrets/views/secret_form_modal_update.cljs"],"mappings":"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","names":["webapp.secrets.views.secret-form-modal-update/add-new-configs","config-map","config-key","config-value","cljs.core/empty?","cljs.core.swap_BANG_","cljs.core/conj","p__31025","map__31026","cljs.core/--destructure-map","cljs.core.get","webapp.secrets.views.secret-form-modal-update/config->inputs","key","value","index","config","key-val","reagent.core.atom","value-val","save","k","v","cljs.core/assoc-in","p1__31023#","cljs.core/deref","p1__31024#","webapp.components.forms/input","cljs.core/reset!","webapp.secrets.views.secret-form-modal-update/config-inputs-for","cljs.core.doall","iter__4652__auto__","s__31036","cljs.core/LazySeq","temp__5753__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4650__auto__","size__4651__auto__","cljs.core/count","b__31038","cljs.core/chunk-buffer","i__31037","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__31035","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","cljs.core.range","webapp.secrets.views.secret-form-modal-update/remove-empty-keys","configs","cljs.core.filter","p__31045","map__31046","clojure.string/blank?","cljs.core.map","p__31041","map__31042","cljs.core.keyword","cljs.core.reduce","cljs.core/into","webapp.secrets.views.secret-form-modal-update/secrets-hashmap->key-value","cljs.core.mapv","p__31049","vec__31051","cljs.core.nth","webapp.secrets.views.secret-form-modal-update/form","current-secret-key","secrets","re_frame.core.subscribe","secret-path-name","secret-value","secret-key","G__31057","p1__31054#","p1__31055#","p1__31056#","webapp.components.headings/h2","e","re-frame.core/dispatch","cljs.core.conj","webapp.components.divider/main","webapp.components.button/secondary","webapp.components.button/primary","cljs.core/chunk-first"],"sourcesContent":["(ns webapp.secrets.views.secret-form-modal-update\n  (:require [clojure.string :as cs]\n            [re-frame.core :as rf]\n            [reagent.core :as r]\n            [webapp.events.secrets]\n            [webapp.components.button :as button]\n            [webapp.components.divider :as divider]\n            [webapp.components.forms :as forms]\n            [webapp.components.headings :as h]))\n\n(defn add-new-configs\n  [config-map config-key config-value]\n\n  (if-not (or (empty? config-key) (empty? config-value))\n    (swap! config-map conj {:key config-key :value config-value})\n    nil))\n\n(defn config->inputs\n  [{:keys [key value]} index config]\n  (let [key-val (r/atom key)\n        value-val (r/atom value)\n        save (fn [k v] (swap! config assoc-in [index k] v))]\n    (fn []\n      [:<>\n       [forms/input {:classes \"whitespace-pre overflow-x\"\n                     :on-change #(reset! key-val (-> % .-target .-value))\n                     :on-blur #(save :key @key-val)\n                     :value @key-val}]\n       [forms/input {:classes \"whitespace-pre overflow-x\"\n                     :on-change #(reset! value-val (-> % .-target .-value))\n                     :on-blur #(save :value @value-val)\n                     :type \"password\"\n                     :value @value-val}]])))\n\n(defn config-inputs-for\n  [config]\n  (doall\n   (for [index (range (count @config))]\n     ^{:key (get @config index)} [config->inputs (get @config index) index config])))\n\n(defn remove-empty-keys\n  [configs]\n  (->> configs\n       (filter (fn [{:keys [key value]}]\n                 (not (or (cs/blank? key) (cs/blank? value)))))\n       (map (fn [{:keys [key value]}] {(keyword key) value}))\n       (reduce into {})))\n\n(defn secrets-hashmap->key-value\n  [configs]\n  (->> configs\n       (mapv (fn [[key value]] {:key key :value value}))))\n\n(defn form [current-secret-key]\n  (let [secrets (rf/subscribe [:secrets->secrets-list])\n        secret-path-name (r/atom current-secret-key)\n        secret-value (r/atom \"\")\n        secret-key (r/atom \"\")\n        configs (r/atom (secrets-hashmap->key-value (current-secret-key @secrets)))]\n    (fn []\n      [:div\n       [:div {:class \"flex justify-between\"}\n        [h/h2 \"Update secret\" {:class \"mb-4 col-span-2\"}]]\n       [:form.mb-regular\n        {:on-submit (fn [e]\n                      (.preventDefault e)\n                      (rf/dispatch [:secrets->delete-secret current-secret-key])\n                      (rf/dispatch [:secrets->update-secrets\n                                    {(keyword @secret-path-name) (remove-empty-keys\n                                                                  (conj @configs {:key @secret-key\n                                                                                  :value @secret-value}))}])\n                      (rf/dispatch [:close-modal]))}\n        [:<>\n         (divider/main)\n         [:div\n          [:<>\n           [:div {:class \"grid grid-cols-2 gap-x-regular\"}\n            [forms/input {:label \"Give a nickname for this secret path\"\n                          :placeholder \"my-mysql-test\"\n                          :on-change #(reset! secret-path-name (-> % .-target .-value))\n                          :required true\n                          :value @secret-path-name}]]\n           [:div.grid.grid-cols-2.gap-regular\n            [:label {:class \"block text-sm font-medium text-gray-700\"} \"Key\"]\n            [:label {:class \"block text-sm font-medium text-gray-700\"} \"Value\"]\n\n            (config-inputs-for configs)\n\n            [forms/input {:on-change #(reset! secret-key (-> % .-target .-value))\n                          :classes \"whitespace-pre overflow-x\"\n                          :placeholder \"Insert key env\"\n                          :value @secret-key}]\n            [forms/input {:on-change #(reset! secret-value (-> % .-target .-value))\n                          :classes \"whitespace-pre overflow-x\"\n                          :placeholder \"Insert value env\"\n                          :type \"password\"\n                          :value @secret-value}]]\n\n           [:div.grid.grid-cols-1.justify-items-end.mb-4\n            (button/secondary {:text \"+ add more\"\n                               :on-click #(do\n                                            (add-new-configs configs @secret-key @secret-value)\n                                            (reset! secret-value \"\")\n                                            (reset! secret-key \"\"))\n                               :variant :small})]\n\n           (divider/main)\n           [:div.grid.grid-cols-2.gap-regular\n            (button/secondary {:text \"Cancel\"\n                               :outlined true\n                               :on-click #(rf/dispatch [:close-modal])})\n            (button/primary {:text \"Update\"\n                             :type \"submit\"})]]]]]])))\n"]}